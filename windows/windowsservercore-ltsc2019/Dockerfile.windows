#escape=`
ARG WINDOWS_SERVER_VERSION=1809
FROM mcr.microsoft.com/powershell:7.1.0-windowsservercore-${WINDOWS_SERVER_VERSION}

SHELL [ "pwsh", "-Command", "$ErrorActionPreference = 'Stop';", "$ProgressPreference = 'SilentlyContinue';" ]

# Install SqlServer module
USER ContainerAdministrator
RUN Install-Module SqlServer -Scope AllUsers -Force -AcceptLicense -RequiredVersion 21.1.18235

USER ContainerUser
COPY .\migrations C:\wfgen\migrations
COPY .\docker-entrypoint.ps1 `
    .\Utils.psm1 `
    C:\
ENTRYPOINT C:\docker-entrypoint.ps1
