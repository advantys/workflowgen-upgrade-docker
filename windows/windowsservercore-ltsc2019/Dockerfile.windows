#escape=`
FROM mcr.microsoft.com/powershell:7.0.2-windowsservercore-1809

SHELL [ "pwsh", "-Command", "$ErrorActionPreference = 'Stop';", "$ProgressPreference = 'SilentlyContinue';" ]

# Install SqlServer module
USER ContainerAdministrator
RUN Install-Module SqlServer -Scope AllUsers -Force -AcceptLicense -RequiredVersion 21.1.18221 && `
    Enable-ExperimentalFeature PSNullConditionalOperators -WarningAction SilentlyContinue

USER ContainerUser
COPY .\migrations C:\wfgen\migrations
COPY .\docker-entrypoint.ps1 `
    .\Utils.psm1 `
    C:\
ENTRYPOINT C:\docker-entrypoint.ps1
