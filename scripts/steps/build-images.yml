parameters:
  - name: osVersion
    type: string
    default: ubuntu-18.04

steps:
  - task: Docker@2
    inputs:
      command: login
      containerRegistry: Docker Hub Advantys
  - task: Docker@2
    inputs:
      command: buildAndPush
      repository: advantys/workflowgen-upgrade
      containerRegistry: Docker Hub Advantys
      buildContext: $(Build.Repository.LocalPath)
      ${{ if eq(variables['agent.os'], 'Linux') }}:
        dockerfile: $(Build.Repository.LocalPath)/linux/ubuntu/Dockerfile.linux
        tags: |
          ${{ variables.APP_VERSION }}-${{ parameters.osVersion }}
          latest-${{ parameters.osVersion }}
          latest
      ${{ if eq(variables['agent.os'], 'Windows_NT') }}:
        dockerfile: $(Build.Repository.LocalPath)/windows/windowsservercore-${{ parameters.osVersion }}/Dockerfile.windows
        tags: |
          ${{ variables.APP_VERSION }}-win-${{ parameters.osVersion }}
          latest-win-${{ parameters.osVersion }}
  - task: Docker@2
    inputs:
      command: logout
      containerRegistry: Docker Hub Advantys
